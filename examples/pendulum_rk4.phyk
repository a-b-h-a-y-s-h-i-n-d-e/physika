# ============================================================
# Simple Pendulum with RK4 Integrator
# ============================================================
# State: x = [θ, ω] where θ = angle, ω = angular velocity
# Equations of motion: dθ/dt = ω, dω/dt = -(g/L)*sin(θ)
# g = 9.81, L = 1.0

# ------------------------------------------------------------
# Pendulum dynamics: f(x) = [x[1], -(g/L)*sin(x[0])]
# ------------------------------------------------------------
def pendulum(x: ℝ[2]): ℝ[2]:
    return [x[1], 0.0 - (9.81 / 1.0) * sin(x[0])]

# ------------------------------------------------------------
# RK4 Integrator (generic, n sub-steps per call)
# ------------------------------------------------------------
class RK4(f: ℝ → ℝ, dt: ℝ, n: ℕ):
    def λ(x: ℝ[2]) → ℝ[2]:
        for k:
            k1 = f(x)
            k2 = f(x + 0.5 * dt * k1)
            k3 = f(x + 0.5 * dt * k2)
            k4 = f(x + dt * k3)
            x = x + dt / 6.0 * (k1 + 2.0 * k2 + 2.0 * k3 + k4)
        return x

# ------------------------------------------------------------
# Solve: 1000 steps of dt=0.01 → t_final = 10s
# ------------------------------------------------------------
dt = 0.01
solver = RK4(pendulum, dt, 1000.0)

# θ₀ = 0.5 rad, ω₀ = 0
solver([0.5, 0.0])

# θ₀ = 1.0 rad, ω₀ = 0
solver([1.0, 0.0])

# ------------------------------------------------------------
# Visualize: single-step integrator + simulate
# ------------------------------------------------------------
step = RK4(pendulum, dt, 1.0)
simulate(step, [0.5, 0.0], 1000.0, dt)
