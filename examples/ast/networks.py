EXPECTED = {'functions': {'sigma': {'params': [('x', 'ℝ')],
                         'return_type': 'ℝ',
                         'body': ('div',
                                  ('num', 1.0),
                                  ('add',
                                   ('num', 1.0),
                                   ('call', 'exp', [('sub', ('num', 0.0), ('var', 'x'))]))),
                         'has_loop': False,
                         'statements': []}},
 'classes': {'OneLayerNet': {'class_params': [('W0',
                                               ('tensor', [(2, 'invariant'), (3, 'invariant')])),
                                              ('c0', ('tensor', [(2, 'invariant')])),
                                              ('w1', ('tensor', [(2, 'invariant')])),
                                              ('b1', 'ℝ')],
                             'lambda_params': [('x', ('tensor', [(3, 'invariant')]))],
                             'return_type': 'ℝ',
                             'body': ('call',
                                      'sigma',
                                      [('add',
                                        ('matmul',
                                         ('var', 'w1'),
                                         ('call',
                                          'sigma',
                                          [('add',
                                            ('matmul', ('var', 'W0'), ('var', 'x')),
                                            ('var', 'c0'))])),
                                        ('var', 'b1'))]),
                             'has_loop': False,
                             'has_loss': True,
                             'loss_params': [('y', 'ℝ'), ('target', 'ℝ')],
                             'loss_body': ('pow',
                                           ('sub', ('var', 'y'), ('var', 'target')),
                                           ('num', 2.0))},
             'FullyConnectedNetwork': {'class_params': [('f', ('func_type', 'ℝ', 'ℝ')),
                                                        ('W',
                                                         ('tensor',
                                                          [(2, 'invariant'),
                                                           (3, 'invariant'),
                                                           (3, 'invariant')])),
                                                        ('B',
                                                         ('tensor',
                                                          [(2, 'invariant'), (3, 'invariant')])),
                                                        ('w', ('tensor', [(3, 'invariant')])),
                                                        ('b', 'ℝ'),
                                                        ('n', 'ℕ')],
                                       'lambda_params': [('x', ('tensor', [(3, 'invariant')]))],
                                       'return_type': 'ℝ',
                                       'has_loop': True,
                                       'has_loss': True,
                                       'loop_var': 'k',
                                       'loop_indexed_arrays': ['W', 'B'],
                                       'loop_body': [('loop_assign',
                                                      'x',
                                                      ('call',
                                                       'f',
                                                       [('add',
                                                         ('matmul',
                                                          ('index', 'W', ('var', 'k')),
                                                          ('var', 'x')),
                                                         ('index', 'B', ('var', 'k')))]))],
                                       'body': ('add',
                                                ('matmul', ('var', 'w'), ('var', 'x')),
                                                ('var', 'b')),
                                       'loss_params': [('y', 'ℝ'), ('target', 'ℝ')],
                                       'loss_body': ('pow',
                                                     ('sub', ('var', 'y'), ('var', 'target')),
                                                     ('num', 2.0))}},
 'program': [('func_def', 'sigma'),
             ('class_def', 'OneLayerNet'),
             ('decl',
              'W0',
              ('tensor', [(2, 'invariant'), (3, 'invariant')]),
              ('array',
               [('array', [('num', 0.1), ('num', 0.2), ('num', 0.3)]),
                ('array', [('num', 0.4), ('num', 0.5), ('num', 0.6)])]),
              20),
             ('decl',
              'c0',
              ('tensor', [(2, 'invariant')]),
              ('array', [('num', 0.1), ('num', 0.2)]),
              21),
             ('decl',
              'w1',
              ('tensor', [(2, 'invariant')]),
              ('array', [('num', 0.7), ('num', 0.8)]),
              22),
             ('decl', 'b1', 'ℝ', ('num', 0.3), 23),
             ('assign',
              'net1',
              ('call', 'OneLayerNet', [('var', 'W0'), ('var', 'c0'), ('var', 'w1'), ('var', 'b1')]),
              24),
             ('expr', ('call', 'net1', [('array', [('num', 1.0), ('num', 2.0), ('num', 3.0)])]), 0),
             ('class_def', 'FullyConnectedNetwork'),
             ('decl',
              'W',
              ('tensor', [(2, 'invariant'), (3, 'invariant'), (3, 'invariant')]),
              ('array',
               [('array',
                 [('array', [('num', 0.1), ('num', 0.2), ('num', 0.3)]),
                  ('array', [('num', 0.4), ('num', 0.5), ('num', 0.6)]),
                  ('array', [('num', 0.7), ('num', 0.8), ('num', 0.9)])]),
                ('array',
                 [('array', [('num', 0.2), ('num', 0.3), ('num', 0.4)]),
                  ('array', [('num', 0.5), ('num', 0.6), ('num', 0.7)]),
                  ('array', [('num', 0.8), ('num', 0.9), ('num', 0.1)])])]),
              41),
             ('decl',
              'B',
              ('tensor', [(2, 'invariant'), (3, 'invariant')]),
              ('array',
               [('array', [('num', 0.1), ('num', 0.2), ('num', 0.3)]),
                ('array', [('num', 0.1), ('num', 0.2), ('num', 0.3)])]),
              43),
             ('decl',
              'w',
              ('tensor', [(3, 'invariant')]),
              ('array', [('num', 0.5), ('num', 0.5), ('num', 0.5)]),
              44),
             ('decl', 'b', 'ℝ', ('num', 0.1), 45),
             ('assign',
              'net2',
              ('call',
               'FullyConnectedNetwork',
               [('var', 'sigma'),
                ('var', 'W'),
                ('var', 'B'),
                ('var', 'w'),
                ('var', 'b'),
                ('num', 2.0)]),
              47),
             ('expr', ('call', 'net2', [('array', [('num', 1.0), ('num', 2.0), ('num', 3.0)])]), 0),
             ('expr', ('call', 'net2', [('array', [('num', 0.0), ('num', 0.0), ('num', 0.0)])]), 0),
             ('expr',
              ('call', 'net2', [('array', [('num', 1.0), ('num', 1.0), ('num', 1.0)])]),
              0)]}
